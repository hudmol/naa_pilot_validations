
# naa_pilot_validations

An ArchivesSpace plugin developed for the National Archives of Australia pilot
project that demonstrates some data validations.

## Installation

To install the `naa_pilot_validations` plugin follow this procedure:

  1. Download the latest version of the `naa_pilot_validations` plugin into your
     `archivesspace/plugins/` directory
  2. Add `naa_pilot_validations` to `AppConfig[:plugins]` in `config.rb`
  3. Restart ArchivesSpace


## Configuration

There is no configuration required.


## Validations

This plugin implements the following validation rules:

  * __Unique Component Identifiers__
  
    This system level rule ensures that Archival Objects' Component Unique
    Identifier fields are unique within a Repository.

  * __Unique Digital Object instances__
  
    This JSONModel level rule ensures that an Archival Object can only link to a
    particular Digital Object once via its Instances.


## Implementation Notes

### System level validations

System level validations are rules that apply to an object with respect to their
context. A good example is uniqueness - this can't be determined simply by
looking at the properties of the object itself, so it is necessary to test the
value against other objects in the system.

These are implemented on the model. See for a couple of examples:
```
  archivesspace/backend/app/model/archival_object.rb
  archivesspace/backend/app/model/instance.rb
```

When extending a model in a plugin it is usually good practice to implement the
extension in a mixin. This ensures that the extended functionality is added
without colliding with existing functionality.

For example, the _Unique Component Identifiers_ rule is implemented in:
```
  backend/model/mixins/item_component_identifiers.rb
```

The mixin is then included in the Archival Object model in:
```
  backend/model/archival_object.rb
```

### JSONModel level validations

JSONModel level validations are rules that apply to the properties of an
individual object. They are conventionally defined in a file called:
```
  common/validations.rb
```

This file is then required by the `backend` and `frontend` in their
initialisation files:
```
  backend/plugin_init.rb
  frontend/plugin_init.rb
```

Note that ArchivesSpace's standard set of validations is similarly defined in:
```
  archivesspace/common/validations.rb
```

### Error message translations

The translations for validation error messages are declared in `locale` files.
This plugin currently only provides English translations, at:
```
  frontend/locales/en.yml
```

The key for a validation error is the error message that is generated by the
backend, with spaces replaced by underscores and all letters downcased. So, for
example, the unique Digital Object error message from the backend looks like
this:
```json
  {
    "error":
    {
      "instances":
      [
        "Cannot have multiple instances of the same digital object"
      ]
    },
    "warning": null,
    "invalid_object": "#<JSONModel(:archival_object) {\"publish\"=>false, ...}"
  }
```

And the corresponding translation entry in `frontend/locales/en.yml` looks like
this:
```
  en:
    validation_errors:
      cannot_have_multiple_instances_of_the_same_digital_object: Cannot have more than one instance of the same Digital Object
```
